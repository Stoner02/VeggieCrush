<!doctype html> 
<html lang="en"> 
<head> 
	<meta charset="UTF-8" />
	<title>Veggie Crush</title>

	<script type="text/javascript" src="js/phaser.min.js"></script>
	<script type="text/javascript" src="js/boot.js"></script>
	<script type="text/javascript" src="js/preload.js"></script>
	<script type="text/javascript" src="js/gametitle.js"></script>
	<script type="text/javascript" src="js/main.js"></script>
	<script type="text/javascript" src="js/gameover.js"></script>

	<link rel="stylesheet" type="text/css" href="style.css">
	<script type="text/javascript">

		var getUrlParameter = function getUrlParameter(sParam) {
			var sPageURL = decodeURIComponent(window.location.search.substring(1)),
				sURLVariables = sPageURL.split('&'),
				sParameterName,
				i;

			for (i = 0; i < sURLVariables.length; i++) {
				sParameterName = sURLVariables[i].split('=');

				if (sParameterName[0] === sParam) {
					return sParameterName[1] === undefined ? true : sParameterName[1];
				}
			}
		};

		(function() {

			game = new Phaser.Game('100', '125', Phaser.AUTO, 'game-container');

			//Add all states
			//Adds a new State into the StateManager
			game.state.add("Boot", Boot);
			game.state.add("Preload", Preload);
			game.state.add("GameTitle", GameTitle);
			game.state.add("Main", Main);
			game.state.add("GameOver", GameOver);

			//Start the first state
			game.state.start("Boot");

		})();
	</script>	
	<script>
   
  window.fbAsyncInit = function() {
    FB.init({
      appId      : '145103292878529',
      cookie     : true,
      xfbml      : true,
      version    : 'v2.11'
    });
      
    FB.AppEvents.logPageView();   
      
  };

  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "https://connect.facebook.net/en_US/sdk.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));
   
   function checkLoginState() {
 
  FB.getLoginStatus(function(response) {
 //   statusChangeCallback(response);
	console.log(response.status);
  });
  
  FB.getLoginStatus(function(response) {
	console.log(response.body);
});
}
/*
document.getElementById('shareBtn').onclick = function() {
  FB.ui({
    method: 'share',
    display: 'popup',
    href: 'http://VeggiesCrush.be',
	quote: 'Mon Score!',
  }, function(response){});
}*/
</script>
</head>
<body> 



	<table id="plateauJeu">
		<tr>
			<!-- *********************** -->
			<!-- Left -->
			<!-- *********************** -->
			<td> 
				
				<!-- *********************** -->
				<!-- Disconnect button -->
				<!-- *********************** -->
				<div id="disconnect">
					<button onclick="disconnect()">Disconnect</button>
				</div>
				<div id="shareBtn"><button>Share on Facebook</button></div>

				<!-- *********************** -->
				<!-- Bonus -->
				<!-- *********************** -->
				<div id="bonus">
					<h2>Bonus: <span id="bonusVal"></span></h2>
				</div>

				<!-- *********************** -->
				<!-- Argent -->
				<!-- *********************** -->
				<div id="money">
					<h2>Argent: <span id="moneyVal"></span></h2>
				</div>

				<!-- *********************** -->
				<!-- Experience -->
				<!-- *********************** -->
				<div id="exp">
					<h2>Expérience: <span id="expVal"></span></h2>
				</div>

				<!-- *********************** -->
				<!-- Ingrédients -->
				<!-- *********************** -->
				<div id="ingredient">
					<h2>Ingrédients: <span id="ingreVal"></span></h2>
				</div>

				<!-- *********************** -->
				<!-- Potions -->
				<!-- *********************** -->
				<table id="potions">
					<!-- Headers -->
					<th>
						<td>RTS</td> <td>FarmVille</td> <td>MMO</td>
					</th>
					<!-- Potions -->
					<tr>
						<td>Potion1: </td> <td id="rts1"> </td> <td id="ville1"> </td> <td id="mmo1"> </td>
					</tr>
					<tr>
						<td>Potion2: </td> <td id="rts2"> </td> <td id="ville2"> </td> <td id="mmo2"> </td>
					</tr>
					<tr>
						<td>Potion3: </td> <td id="rts3"> </td> <td id="ville3"> </td> <td id="mmo3"> </td>
					</tr>
					<tr>
						<td>Potion4: </td> <td id="rts4"> </td> <td id="ville4"> </td> <td id="mmo4"> </td>
					</tr>
				</table>



			</td>
			<!-- *********************** -->
			<!-- Middle -->
			<!-- *********************** -->
			<td> 
				<div id="game-container"></div>
				
				<div id="message"><p>Vous venez de vendre une potion du chat.</p></div>
			</td>
			<!-- *********************** -->
			<!-- Right -->
			<!-- *********************** -->
			<td> 

				<!-- *********************** -->
				<!-- Vous êtes ici -->
				<!-- *********************** -->
				<div id="position">
					<h2>Vous êtes ici: <span id="valPosition"></span></h2>
				</div>

				<!-- *********************** -->
				<!-- Coordonnées -->
				<!-- *********************** -->
				<form id="coord">
					<h2>Coordonnées</h2>
					X:
					<input type="text" id="xCoord" value="">
					Y:
					<input type="text" id="yCoord" value="">
					<input value="Go" onclick="changePosition()">
				</form> 


				<!-- *********************** -->
				<!-- Villages -->
				<!-- *********************** -->
				<form id="village">
					<h2>Villages</h2>
					<select name="village" size="4" id="villageSelect">
	
					</select>
					<input value="Go" onclick="changeVillage()">
				</form>


				<!-- *********************** -->
				<!-- BG -->
				<!-- *********************** -->
				<form  id="bg">
					<h2>Champ de bataille</h2>
					<select name="bg" size="4" id="bgSelect">
					</select>
					<input value="Go" onclick="changeBg()">
				</form>
				
			</td>
		</tr>
	</table>


	<!-- BEGIN JAVASCRIPT -->
	<script src='https://ajax.googleapis.com/ajax/libs/angularjs/1.4.5/angular.min.js'></script>
	<script src='http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
	<script src='https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.6/js/materialize.min.js'></script>
	<script type="text/javascript" src="js/node_modules/socket.io-client/dist/socket.io.js"></script>
	<script type="text/javascript">

		var socket = io.connect();

		var pseudo = getUrlParameter('pseudo');
		var mdp = getUrlParameter('mdp');		
		socket.emit('isAllowedToPlay', pseudo, mdp);

		socket.on('getAutorisationCon', function (data) {
			console.log("VERI AUTORISATION: " + data.autorisation);
			if(!data.autorisation){
				window.location = "index.html";
			}
			else{
				//-------------------------------------
				// Récupérer toutes les potions
				//-------------------------------------
				socket.emit('getAllPopo');
				//-------------------------------------
				// Récupérer l'argent/exp
				//-------------------------------------
				socket.emit('getMoneyExp');
				//-------------------------------------
				// Récupérer la position du joueur
				//-------------------------------------
				socket.emit('getCoord');
				//-------------------------------------
				// Récupérer tous les villages
				//-------------------------------------
				socket.emit('getVillages');
				//-------------------------------------
				// Récupérer tous les bg
				//-------------------------------------
				socket.emit('getBg');
			}
		});


		//-------------------------------------
		// Met à jour les coordonnées
		//-------------------------------------
		socket.on('updateCoord', function (data) {
			document.getElementById("xCoord").value.innerHTML = data.x;
			document.getElementById("yCoord").value.innerHTML = data.y;
		});

		//-------------------------------------
		// Met à jour toutes les potions
		//-------------------------------------
		socket.on('receiveAllPopo', function (data) {
			document.getElementById("mmo1").innerHTML = data.mmo1;
			document.getElementById("mmo2").innerHTML = data.mmo2;
			document.getElementById("mmo3").innerHTML = data.mmo3;
			document.getElementById("mmo4").innerHTML = data.mmo4;

			document.getElementById("rts1").innerHTML = data.rts1;
			document.getElementById("rts2").innerHTML = data.rts2;
			document.getElementById("rts3").innerHTML = data.rts3;
			document.getElementById("rts4").innerHTML = data.rts4;

			document.getElementById("ville1").innerHTML = data.ville1;
			document.getElementById("ville2").innerHTML = data.ville2;
			document.getElementById("ville3").innerHTML = data.ville3;
			document.getElementById("ville4").innerHTML = data.ville4;
		});

		//-------------------------------------
		// Met à jour les villages
		//-------------------------------------
		socket.on('receiveVillages', function (data) {

			var array = data.villages;
			var villageSelect = document.getElementById('villageSelect');
			villageSelect.innerHTML = "";

			for(var i = 0; i < array.length; i++) {
				var opt = document.createElement('option');
				opt.innerHTML = array[i];
				opt.value = array[i];
				villageSelect.appendChild(opt);
			}
		});

		//-------------------------------------
		// Met à jour les bg
		//-------------------------------------
		socket.on('receiveBg', function (data) {

			console.log("receiveBg");

			var array = data.bg;
			var bgSelect = document.getElementById('bgSelect');
			bgSelect.innerHTML = "";

			for(var i = 0; i < array.length; i++) {
				var opt = document.createElement('option');
				opt.innerHTML = array[i];
				opt.value = array[i];
				bgSelect.appendChild(opt);
			}
		});

		//-------------------------------------
		// Prévient changement position
		//-------------------------------------
		function changePosition(){
			console.log("changePosition")
			var x = document.getElementById("xCoord").value;
			var y = document.getElementById("yCoord").value;
			socket.emit("changePosition", {xCoord: x, yCoord: y});
			document.getElementById("valPosition").innerHTML = "(" + x + ";" + y +")";
		}

		//-------------------------------------
		// Prévient changement village
		//-------------------------------------
		function changeVillage(){
			var villageSelected = $("#villageSelect option:selected").text();
			socket.emit("updateVillage", {village: villageSelected});
			document.getElementById("valPosition").innerHTML = villageSelected + " (Village)";
		}

		//-------------------------------------
		// Prévient changement bg
		//-------------------------------------
		function changeBg(){
			var bgSelected = $("#bgSelect option:selected").text();
			socket.emit("updateBg", {bg: bgSelected});
			document.getElementById("valPosition").innerHTML = bgSelected + " (BG)";
		}

		//-------------------------------------
		// Met à jour l'argent et l'exp
		//-------------------------------------
		socket.on('updateExperienceArgent', function (data) { console.log("updateExperienceArgent: " + data.argent);
			document.getElementById("moneyVal").innerHTML = data.argent;
			document.getElementById("expVal").innerHTML = data.exp;
		});


		//-------------------------------------
		// Met à jour le bonus
		//-------------------------------------
		socket.on('updateBonus', function (data) {
			document.getElementById("bonusVal").innerHTML = data.bonus;
		});

		//-------------------------------------
		// disconnect client
		//-------------------------------------
		function disconnect() {
			socket.emit('userDisconnect');
			window.location = "index.html";
		} 
	
		//-------------------------------------
		// Connexion réussie
		//-------------------------------------
		socket.on('connecte', function (data) {
			console.log("Connecte.");
		});

		//-------------------------------------
		// Précise l'erreur de connexion
		//-------------------------------------
		socket.on('erreurConnexion', function (data) {
			console.log("Erreur connexion.");
		});
		

		document.getElementById('shareBtn').onclick = function() {
		  FB.ui({
			method: 'share',
			display: 'popup',
			href: 'http://VeggiesCrush.be',
			quote: 'Mon expérience:'+document.getElementById("expVal").innerHTML+'!',
		  }, function(response){});
		}

	
	</script>

</body>



</html>