<!doctype html> 
<html lang="en"> 
<head> 
	<meta charset="UTF-8" />
	<title>Veggie Crush</title>

	<script type="text/javascript" src="js/phaser.min.js"></script>
	<script type="text/javascript" src="js/boot.js"></script>
	<script type="text/javascript" src="js/preload.js"></script>
	<script type="text/javascript" src="js/gametitle.js"></script>
	<script type="text/javascript" src="js/main.js"></script>
	<script type="text/javascript" src="js/gameover.js"></script>

	<link rel="stylesheet" type="text/css" href="css/style.css">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
	<script type="text/javascript">

		var getUrlParameter = function getUrlParameter(sParam) {
			var sPageURL = decodeURIComponent(window.location.search.substring(1)),
				sURLVariables = sPageURL.split('&'),
				sParameterName,
				i;

			for (i = 0; i < sURLVariables.length; i++) {
				sParameterName = sURLVariables[i].split('=');

				if (sParameterName[0] === sParam) {
					return sParameterName[1] === undefined ? true : sParameterName[1];
				}
			}
		};

		(function() {

			game = new Phaser.Game('100', '125', Phaser.AUTO, 'game-container');

			//Add all states
			//Adds a new State into the StateManager
			game.state.add("Boot", Boot);
			game.state.add("Preload", Preload);
			game.state.add("GameTitle", GameTitle);
			game.state.add("Main", Main);
			game.state.add("GameOver", GameOver);

			//Start the first state
			game.state.start("Boot");

		})();
	</script>	
	<script>
   
  window.fbAsyncInit = function() {
    FB.init({
      appId      : '145103292878529',
      cookie     : true,
      xfbml      : true,
      version    : 'v2.11'
    });
      
    FB.AppEvents.logPageView();   
      
  };

  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "https://connect.facebook.net/en_US/sdk.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));
   
   function checkLoginState() {
 
  FB.getLoginStatus(function(response) {
 //   statusChangeCallback(response);
	console.log(response.status);
  });
  
  FB.getLoginStatus(function(response) {
	console.log(response.body);
});
}
/*
document.getElementById('shareBtn').onclick = function() {
  FB.ui({
    method: 'share',
    display: 'popup',
    href: 'http://VeggiesCrush.be',
	quote: 'Mon Score!',
  }, function(response){});
}*/
</script>
<!-- ========================== NAV BAR ==================  -->
	<nav class="navbar navbar-dark bg-dark">
		<!-- Navbar content -->

			<div id="shareBtn">
				<button class="btn btn-primary my-2 my-lg-3" > Partager sur Facebook ! </button>
				
			</div>
			<img src="assets/topbar/alchimiste.png"  width="500" height="70" alt="">
			<!-- *********************** -->
			<!-- Disconnect button -->
			<!-- *********************** -->
			<div id="disconnect">
					<button class="btn btn-outline-success my-2 my-sm-3" onclick="disconnect()">Se déconnecter</button>
			</div>
	</nav>
</head>

<body> 


	<!-- ============================== LEFT ======================== -->

	<div class="row no-gutters">
		<div class="order-2 col-xs-6 col-md-4">
			<div class="card bg-dark text white" >
					<img class="card-img" src="assets/background/flag.gif" style="max-height: 870px;" alt="Card image">
					<div class="card-img-overlay">
											<!-- *********************** -->
						<!-- Bonus -->
						<!-- *********************** -->
						
						<h2>Bonus : <span id="bonusVal"></span></h2>
						
						<!-- *********************** -->
						<!-- Argent -->
						<!-- *********************** -->
				
							<h2>Argent : <span id="moneyVal"></span></h2>
				
						<!-- *********************** -->
						<!-- Experience -->
						<!-- *********************** -->
					
							<h2>Expérience : <span id="expVal"></span></h2>
					
		
							<!-- *********************** -->
							<!-- Ingrédients -->
							<!-- *********************** -->
							<div id="ingredient">
								<h2>Ingrédients : <span id="ingreVal"></span></h2>
							</div>
		
						<div class="col classWithPad-top-table">
						<!-- *********************** -->
						<!-- Potions -->
						<!-- *********************** -->
						<table class="table table-striped table-dark classWithPad-top" id="potions">
							<thead>
							<!-- Headers -->
								<th>
									<td>RTS</td> <td>FarmVille</td> <td>MMO</td>
								</th>
							</thead>
							<!-- Potions -->
							<tr>
								<td>Potion 1 </td> <td id="rts1"> </td> <td id="ville1"> </td> <td id="mmo1"> </td>
							</tr>
							<tr>
								<td>Potion 2 </td> <td id="rts2"> </td> <td id="ville2"> </td> <td id="mmo2"> </td>
							</tr>
							<tr>
								<td>Potion 3 </td> <td id="rts3"> </td> <td id="ville3"> </td> <td id="mmo3"> </td>
							</tr>
							<tr>
								<td>Potion 4 </td> <td id="rts4"> </td> <td id="ville4"> </td> <td id="mmo4"> </td>
							</tr>
						</table>
					</div> <!--table -->
				</div> <!-- card over l.--> 
			</div> <!-- card --> 
		</div> <!-- col 1 --> 
		<!-- end row  -->

		
		<div class="order-1 col-xs-6 col-md-4" style="background-color: #6A5A32 ;">
			<div id="game-container"></div>
			<div class="row" >
						<div id="message"><p>Vous venez de vendre une potion du chat.</p></div>
			</div>	
		</div> 
		 
		<div class="order-3 col-xs-6 col-md-4">
			<div class="card bg-dark text white">
					<img class="card-img" src="assets/background/waneella.gif"  style="max-height: 870px;" alt="Card image">
					<div class="card-img-overlay">

							<!-- <div class="row" id="position"> -->
								<div class=" form-group classWithPad-top">
									<div class="form-group">
										<h2>Vous êtes ici : </h2>
									</div>
									<div class="row  classWithPad-top">
										<div class="col-1">
											<span id="valPosition"></span>
										</div>
									</div>
								</div>
							<!-- </div> -->
					
								<!-- *********************** -->
								<!-- Coordonnées -->
								<!-- *********************** -->
								<form id="coord" class="classWithPad-top">
									<div class="form-group">
										<h2>Coordonnées : </h2>
										<div class="row  classWithPad-top">
											<div class="col-1">
												<h3>X</h3>
											</div>

											<div class="col-2">
												<input type="number" id="xCoord" value="">
											</div>
										</div>

										<div class="row">
											<div class="col-1 ">
													<h3>Y</h3>
											</div>
											<div class="col-5">
													<input type="number" id="yCoord" value="">
											</div>
											<div class="col-2">
												<button type="button" class="btn btn-primary" onclick="changePosition()">GO</button>
											<!-- <input value="Go" onclick="changePosition()"> -->
											</div>
										</div>
									</div>
								</form> 
								<!-- *********************** -->
								<!-- Villages -->
								<!-- *********************** -->
								
								<form id="village" class="classWithPad-top">
									<h2>Villages</h2>
									<div class="row">
										<div class="col-8">
											<select class="form-control" name="village"  id="villageSelect"></select>
										</div>

										<div class="col-2">
											<button type="button" class="btn btn-primary" onclick="changePosition()">GO</button>
											<!-- <input value="Go" onclick="changeBg()"> -->
										</div>
										<!-- <button type="button" class="btn btn-primary" onclick="changePosition()">GO</button> -->
										<!-- <input value="Go" onclick="changeVillage()"> -->
									</div>
								</form>
								
								<!-- *********************** -->
								<!-- BG -->
								<!-- *********************** -->
								<form  id="bg" class="classWithPad-top">
									<h2>Champ de bataille</h2>
									<div class="row">
										<div class="col-8">
												<select class="form-control" name="bg" id="bgSelect">
											</select>
										</div>
										<div class="col-2">
											<button type="button" class="btn btn-primary" onclick="changePosition()">GO</button>
											<!-- <input value="Go" onclick="changeBg()"> -->
										</div>
									</div>
								</form>
					</div> <!-- card over l.--> 
			</div> <!-- card --> 
		</div> <!-- col --> 
	</div>


		
		
 


	<!-- BEGIN JAVASCRIPT -->
	<script type="text/javascript" src="js/node_modules/socket.io-client/dist/socket.io.js"></script>
	<script type="text/javascript">

		var socket = io.connect();

		var pseudo = getUrlParameter('pseudo');
		var mdp = getUrlParameter('mdp');		
		socket.emit('isAllowedToPlay', pseudo, mdp);

		socket.on('getAutorisationCon', function (data) {
			
			if(!data.autorisation){
				console.log("NO AUTORISATION");
				window.location = "index.html";
			}
			else{ 
				console.log("AUTORISATION OK");
				/*
				//-------------------------------------
				// Récupérer toutes les potions
				//-------------------------------------
				socket.emit('getAllPopo');
				//-------------------------------------
				// Récupérer l'argent/exp
				//-------------------------------------
				socket.emit('getMoneyExp');
				//-------------------------------------
				// Récupérer la position du joueur
				//-------------------------------------
				socket.emit('getCoord');
				//-------------------------------------
				// Récupérer tous les villages
				//-------------------------------------
				socket.emit('getVillages');
				//-------------------------------------
				// Récupérer tous les bg
				//-------------------------------------
				socket.emit('getBg'); */
			}
		});


		//-------------------------------------
		// Met à jour les coordonnées
		//-------------------------------------
		socket.on('updateCoord', function (data) {
			document.getElementById("xCoord").value.innerHTML = data.x;
			document.getElementById("yCoord").value.innerHTML = data.y;
		});

		//-------------------------------------
		// Met à jour toutes les potions
		//-------------------------------------
		socket.on('receiveAllPopo', function (data) {
			document.getElementById("mmo1").innerHTML = data.mmo1;
			document.getElementById("mmo2").innerHTML = data.mmo2;
			document.getElementById("mmo3").innerHTML = data.mmo3;
			document.getElementById("mmo4").innerHTML = data.mmo4;

			document.getElementById("rts1").innerHTML = data.rts1;
			document.getElementById("rts2").innerHTML = data.rts2;
			document.getElementById("rts3").innerHTML = data.rts3;
			document.getElementById("rts4").innerHTML = data.rts4;

			document.getElementById("ville1").innerHTML = data.ville1;
			document.getElementById("ville2").innerHTML = data.ville2;
			document.getElementById("ville3").innerHTML = data.ville3;
			document.getElementById("ville4").innerHTML = data.ville4;
		});

		//-------------------------------------
		// Met à jour les villages
		//-------------------------------------
		socket.on('receiveVillages', function (data) {

			var array = data.villages;
			var villageSelect = document.getElementById('villageSelect');
			villageSelect.innerHTML = "";

			for(var i = 0; i < array.length; i++) {
				var opt = document.createElement('option');
				opt.innerHTML = array[i];
				opt.value = array[i];
				villageSelect.appendChild(opt);
			}
		});

		//-------------------------------------
		// Met à jour les bg
		//-------------------------------------
		socket.on('receiveBg', function (data) {

			console.log("receiveBg");

			var array = data.bg;
			var bgSelect = document.getElementById('bgSelect');
			bgSelect.innerHTML = "";

			for(var i = 0; i < array.length; i++) {
				var opt = document.createElement('option');
				opt.innerHTML = array[i];
				opt.value = array[i];
				bgSelect.appendChild(opt);
			}
		});

		//-------------------------------------
		// Prévient changement position
		//-------------------------------------
		function changePosition(){
			console.log("changePosition")
			var x = document.getElementById("xCoord").value;
			var y = document.getElementById("yCoord").value;
			socket.emit("changePosition", {xCoord: x, yCoord: y});
			document.getElementById("valPosition").innerHTML = "(" + x + ";" + y +")";
		}

		//-------------------------------------
		// Prévient changement village
		//-------------------------------------
		function changeVillage(){
			var villageSelected = $("#villageSelect option:selected").text();
			socket.emit("updateVillage", {village: villageSelected});
			document.getElementById("valPosition").innerHTML = villageSelected + " (Village)";
		}

		//-------------------------------------
		// Prévient changement bg
		//-------------------------------------
		function changeBg(){
			var bgSelected = $("#bgSelect option:selected").text();
			socket.emit("updateBg", {bg: bgSelected});
			document.getElementById("valPosition").innerHTML = bgSelected + " (BG)";
		}

		//-------------------------------------
		// Met à jour l'argent et l'exp
		//-------------------------------------
		socket.on('updateExperienceArgent', function (data) { console.log("updateExperienceArgent: " + data.argent);
			document.getElementById("moneyVal").innerHTML = data.argent;
			document.getElementById("expVal").innerHTML = data.exp;
		});


		//-------------------------------------
		// Met à jour le bonus
		//-------------------------------------
		socket.on('updateBonus', function (data) {
			document.getElementById("bonusVal").innerHTML = data.bonus;
		});

		//-------------------------------------
		// disconnect client
		//-------------------------------------
		function disconnect() {
			socket.emit('userDisconnect');
			window.location = "index.html";
		} 
	
		//-------------------------------------
		// Connexion réussie
		//-------------------------------------
		socket.on('connecte', function (data) {
			console.log("Connecte.");
		});

		//-------------------------------------
		// Précise l'erreur de connexion
		//-------------------------------------
		socket.on('erreurConnexion', function (data) {
			console.log("Erreur connexion.");
		});
		

		document.getElementById('shareBtn').onclick = function() {
		  FB.ui({
			method: 'share',
			display: 'popup',
			href: 'http://VeggiesCrush.be',
			quote: 'Mon expérience:'+document.getElementById("expVal").innerHTML+'!',
		  }, function(response){});
		}

	
	</script>

</body>



</html>